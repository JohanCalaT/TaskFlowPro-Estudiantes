@using TaskFlowPro.Web.Services
@using TaskFlowPro.Web.Components.UI
@inject IUIStateService UIState
@namespace TaskFlowPro.Web.Features.Teams.Components

<div class="space-y-6 animate-fadeInUp">
    <!-- Header Section -->
    <div class="flex items-center gap-3 animate-slideInLeft">
        <Button Variant="Button.ButtonVariant.Ghost"
                OnClick="HandleBack"
                Icon="fas fa-arrow-left"
                Size="Button.ButtonSize.Small"
                class="hover:bg-primary/10 hover:text-primary" />
        
        <div class="icon-container">
            <i class="fas fa-users-cog text-white"></i>
        </div>
        <div>
            <h1 class="page-title">Create New Team</h1>
            <p class="page-subtitle">Set up a new team for your organization</p>
        </div>
    </div>

    <!-- Form -->
    <Card HasShadow="true" IsGlass="true" IsAnimated="true">
        <Header>
            <div class="flex items-center gap-2">
                <i class="fas fa-users text-primary"></i>
                <span class="card-title">Team Information</span>
            </div>
        </Header>
        
        <ChildContent>
            <form @onsubmit="HandleSubmit" @onsubmit:preventDefault="true" class="space-y-6">
                @if (!string.IsNullOrEmpty(errorMessage))
                {
                    <div class="border border-status-urgent/20 bg-status-urgent/5 rounded-md p-3 animate-fadeInUp">
                        <p class="text-status-urgent text-sm">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            @errorMessage
                        </p>
                    </div>
                }
                
                <Input Id="name"
                       Label="Team Name"
                       @bind-Value="formData.Name"
                       Placeholder="Enter team name..."
                       LeftIcon="fas fa-users"
                       IsRequired="true"
                       Size="Input.InputSize.Large" />
                
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-foreground/80">Description</label>
                    <textarea @bind="formData.Description"
                              placeholder="Describe the team's purpose and responsibilities..."
                              rows="4"
                              class="block w-full rounded-md border border-border/50 px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200"></textarea>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-foreground/80">Team Leader</label>
                    <select @bind="formData.LeaderId"
                            class="block w-full rounded-md border border-border/50 px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary transition-all duration-200">
                        <option value="">Select team leader...</option>
                        @foreach (var user in GetAvailableLeaders())
                        {
                            <option value="@user.Id">@user.FirstName @user.LastName (@user.Email)</option>
                        }
                    </select>
                </div>
                
                <div class="flex gap-4 pt-4">
                    <Button Type="submit" 
                            Variant="Button.ButtonVariant.Primary"
                            IsLoading="isLoading"
                            Icon="fas fa-save"
                            class="flex-1">
                        @if (isLoading)
                        {
                            <span>Creating Team...</span>
                        }
                        else
                        {
                            <span>Create Team</span>
                        }
                    </Button>
                    
                    <Button Type="button"
                            Variant="Button.ButtonVariant.Ghost"
                            OnClick="HandleBack"
                            Icon="fas fa-times">
                        Cancel
                    </Button>
                </div>
            </form>
        </ChildContent>
    </Card>
</div>

@code {
    private TeamFormData formData = new();
    private bool isLoading = false;
    private string errorMessage = "";

    private async Task HandleSubmit()
    {
        errorMessage = "";
        
        // Validate form
        if (string.IsNullOrWhiteSpace(formData.Name))
        {
            errorMessage = "Team name is required";
            return;
        }
        
        if (string.IsNullOrWhiteSpace(formData.Description))
        {
            errorMessage = "Team description is required";
            return;
        }
        
        isLoading = true;
        
        try
        {
            // Simulate API call
            await Task.Delay(1500);
            
            UIState.ShowSuccess("Team created successfully!");
            HandleBack();
        }
        catch (Exception)
        {
            errorMessage = "An error occurred while creating the team";
        }
        finally
        {
            isLoading = false;
        }
    }

    private void HandleBack()
    {
        UIState.NavigateTo("teams");
    }

    private List<MockUser> GetAvailableLeaders()
    {
        return MockDataService.GetMockUsers()
            .Where(u => u.Role == "team_leader" || u.Role == "global_admin")
            .ToList();
    }

    private class TeamFormData
    {
        public string Name { get; set; } = "";
        public string Description { get; set; } = "";
        public string LeaderId { get; set; } = "";
    }
}
